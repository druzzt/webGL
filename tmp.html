  Pen.prototype = {
        //turn:
        function turn(deg) {
            //console.log("in turn, deg = "+deg);
            this.dir2d = true;
            this.dir += deg;
            this.dir = this.dir % 360;
            return this;
        },
        //turnZ:
        function turnZ(deg) {
            //console.log("in turnZ, deg = "+deg);
            this.dir2d = false;
            this.dirZ += deg;
            this.dirZ = this.dirZ % 360;
            return this;
        },
        
        
        //fillstyle:
        function fillstyle(style) {
            this.fillStyle = this.canvas.fillStyle = style;
            
            return this;
        },
        
        //set:
        function set() {
            this.homes.push({ x: this.x, y: this.y, angle: this.dir });
            return this;
        },
        
        //angle:
        function angle(a) {
            this.dir = a - 90;
            return this;
        },
        
        //home:
        function home() {
            var last = this.homes.pop();
            this.dir = last.angle;
            return this.goto(this.x, this.y);
        },
        
        //go:
        function go(r) {
            //console.log("in go");
            var a = this.toRad(this.dir);
            var b = this.toRad(this.dirZ);
            
            if(this.dir2d) {
                this.x += r * Math.cos(a);
                this.y += r * Math.sin(a);
                //console.log("in 2d");
            }
            else
            this.z += r * Math.sin(b);
            points[points.length] = [turtle.x, turtle.y, turtle.z];
            return this;
        },
        
        //back:
        function back(r) {
            this.turn(-180);
            this.go(r);
            this.turn(180);
            
            return this;
        },
        
        //stroke:
        function stroke() {
            this.canvas.stroke();
            
            return this;
        },
        
        //fill:
        function fill() {
            this.canvas.fill();
            
            return this;
        },
        
        //begin:
        function begin() {
            this.canvas.beginPath();
            
            return this;
        },
        
        //close:
        function close() {
            this.canvas.closePath();
            
            return this;
        },
        
        //draw:
        function draw() {
            if (this.fillStyle)
            this.fill();
            if (this.lineWidth)
            this.stroke();
            
            return this;
        },
        
        //penup:
        function penup() {
            this.pen = false;
            
            return this;
        },
        
        //pendown:
        function pendown() {
            this.pen = true;
            
            return this;
        },
        
        //goto:
        function goto(x, y) {
            this.x = x;
            this.y = y;
            
            if (!this.pen)
            this.canvas.moveTo(x, y);
            else
            this.canvas.lineTo(x, y);
            
            return this;
        },
        
        //goto:
        function goto(x, y, z) {
            this.x = x;
            this.y = y;
            this.z = z;
            
            if (!this.pen)
            this.canvas.moveTo(x, y);
            else
            this.canvas.lineTo(x, y);
            
            return this;
        },
        
        
        //jump:
        function jump(x, y) {
            this.canvas.beginPath();
            
            var p = this.pen;
            this.pen = true;
            this.goto(x, y);
            this.pen = p;
            
            return this;
        },
        
        //up:
        function up(r) {
            return this.goto(this.x, this.y - r);
        },
        
        //down:
        function down(r) {
            return this.goto(this.x, this.y + r);
        },
        
        //left:
        function left(r) {
            return this.goto(this.x - r, this.y);
        },
        
        //right:
        function right(r) {
            return this.goto(this.x + r, this.y);
        },
        
        //polar:
        function polar(r, angle) {
            var a = this.toRad(angle + this.dir);
            
            this.x = this.ox + r * Math.cos(a);
            this.y = this.oy + r * Math.sin(a);
            
            if (this.pen)
            this.canvas.lineTo(this.x, this.y);
            else
            this.canvas.moveTo(this.x, this.y);
            
            return this;
        },
        
        //origin:
        function origin() {
            this.ox = this.x;
            this.oy = this.y;
            
            return this;
        },
        
        //rad: Math.PI / 180.0,
        function rad() {
            return Math.PI/180.0;
        }
        //toRad:
        function toRad(d) {
            return d * this.rad;
        },
        
        //pensize:
        function pensize(size) {
            this.lineWidth = this.canvas.lineWidth = size;
            
            return this;
        },
        
        //penstyle:
        function penstyle(str) {
            this.canvas.strokeStyle = this.strokeStyle = str;
            
            return this;
        },
        
        //text:
        function text(str) {
            this.canvas.fillText(str, this.x, this.y);
            
            return this;
        },
        
        //font:
        function font(str) {
            this.canvas.font = str;
            
            return this;
        }
    };
